<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lab 1 – x86 Shellcode Reconstruction</title>
  <link rel="stylesheet" href="assets/css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
</head>
<body>
  <div class="container">
    <h1>🧪 Red Team Lab Report: Reconstructing x86 Linux Shellcode (<code>execve("/bin/sh")</code>)</h1>
    <p><strong>Author:</strong> Alexander Nichols<br>
       <strong>Date:</strong> July 5th, 2025<br>
       <strong>Platform:</strong> Kali Linux<br>
       <strong>Category:</strong> Red Team Development / Reverse Engineering / Assembly<br>
       <strong>Objective:</strong> Disassemble, understand, and reconstruct <code>execve("/bin/sh")</code> shellcode from raw bytes.
    </p>
    <hr>
    <h2>🛏️ Overview</h2>
    <p>This lab documents the full hands-on journey of analyzing a shell-spawning Linux payload generated by <code>msfvenom</code>, reverse engineering it byte-by-byte, and ultimately reconstructing a clean version from scratch in NASM.</p>
    <p>The payload invokes:</p>
    <pre><code class="language-c">execve("/bin/sh", NULL, NULL);</code></pre>
    <p>a minimal and powerful syscall used in countless Red Team payloads and post-exploitation tooling.</p>
    <hr>
    <h2>🧠 Goals</h2>
    <ul>
      <li>Generate and inspect raw Linux x86 shellcode with <code>msfvenom</code></li>
      <li>Disassemble with <code>ndisasm</code> and analyze opcode logic</li>
      <li>Rebuild clean shellcode from scratch in NASM</li>
      <li>Debug segmentation faults and operand errors</li>
      <li>Compare real-world shellcode vs clean lab variant</li>
    </ul>
    <hr>
    <h2>🛠️ Lab Environment</h2>
    <table>
      <tr><th>Component</th><th>Details</th></tr>
      <tr><td>OS</td><td>Kali Linux 2024.2 (64-bit)</td></tr>
      <tr><td>Architecture</td><td>32-bit (x86, via <code>ld -m elf_i386</code>)</td></tr>
      <tr><td>Tools Used</td><td><code>msfvenom</code>, <code>nasm</code>, <code>ndisasm</code>, <code>ld</code>, <code>gdb</code>, <code>xxd</code>, <code>nano</code></td></tr>
      <tr><td>Directory</td><td><code>~/red_team_labs/1_x86_shellcode_reconstructing_malware</code></td></tr>
      <tr><td>Payload</td><td><code>linux/x86/exec CMD="/bin/sh"</code></td></tr>
    </table>
    <hr>
    <h2>📦 Step 1: Generate Shellcode with <code>msfvenom</code></h2>
    <pre><code class="language-bash">mkdir -p ~/red_team_labs/1_x86_shellcode_reconstructing_malware
cd ~/red_team_labs/1_x86_shellcode_reconstructing_malware
msfvenom -p linux/x86/exec CMD="/bin/sh" -f raw -o shellcode.raw
xxd shellcode.raw</code></pre>
    <hr>
    <h2>🔍 Step 2: Disassemble with <code>ndisasm</code></h2>
    <pre><code class="language-bash">ndisasm -b 32 shellcode.raw</code></pre>
    <hr>
    <h2>🚫 Initial Assembly Attempt</h2>
    <pre><code class="language-nasm">BITS 32
global _start
section .text
_start:
    push byte +0xb
    pop eax
    cdq
    push edx
    push word 0x632d
    mov edi, esp
    push dword 0x68732f
    push dword 0x6e69622f
    mov ebx, esp
    push edx
    call short get_string
get_string:
    pop ecx
    mov ecx, esp
    int 0x80</code></pre>
    <hr>
    <h2>✅ Final Working shell.asm</h2>
    <pre><code class="language-nasm">BITS 32
global _start
section .text
_start:
    mov eax, 0xb
    cdq
    push edx
    push dword 0x68732f2f
    push dword 0x6e69622f
    mov ebx, esp
    push edx
    xor ecx, ecx
    int 0x80</code></pre>
    <hr>
    <h2>🔧 Build and Run</h2>
    <pre><code class="language-bash">nasm -f elf32 shell.asm -o shell.o
ld -m elf_i386 shell.o -o shell
./shell</code></pre>
    <hr>
    <h2>🔐 Red Teaming Value</h2>
    <ul>
      <li>Linux syscall register mapping</li>
      <li>x86 assembly syntax and calling conventions</li>
      <li>Disassembly and reverse engineering</li>
      <li>Avoiding and debugging segmentation faults</li>
      <li>Stripping obfuscation for clarity</li>
    </ul>
    <hr>
    <h2>✅ Skills Demonstrated</h2>
    <p>✅ Linux syscall internals<br>✅ Shellcode reconstruction<br>✅ Disassembly and debugging<br>✅ Assembly authoring<br>✅ Reverse engineering mindset</p>
    <hr>
    <div class="back-button">
      <a href="labs.html">⬅ Back to Labs</a>
    </div>
  </div>
  <button id="mode-toggle">🌙</button>
  <script src="assets/js/darkmode.js"></script>
</body>
</html>
